{% extends 'taxbrain/input_base.html' %}
{% load staticfiles %}
{% load flatblocks %}
{% block style %}
{% load results %}
{{block.super}}
<link href="{% static 'css/vendor/bootstrap3-block-grid.min.css' %}" rel="stylesheet">
<link href="text/javascript" src="{% static 'js/vendor/DataTables/datatables.min.css' %}"></link>
<style>
  .btn {
    color: black;
  }
  .text-white {
    color: white;
  }
  .table > thead > tr > th {
    border: 0;
  }
  .single-line {
    white-space: nowrap;
  }
  .param-text {
      margin-left: 80px;
      margin-right: 80px;
      margin-top: 40px;
      margin-bottom: 40px;
      text-align: left;
  }
  .file-contents{
      font-family: "Courier New", Courier, monospace;
      font-weight: bold;
      margin-left: 80px;
      margin-right: 80px;
      margin-top: 40px;
      margin-bottom: 40px;
      text-align: left;
  }
</style>
{% endblock %}
{% block content %}
<div class="wrapper">
  {% include 'taxbrain/header.html' %}
  <div class="result-header">
    <div class="result-header-control">
      {% if results_type == "static" %}
        <h1>Static Results</h1>
      {% else %}
        <h1>Partial Equilibrium Results</h1>
      {% endif %}
    </div>
    <p class="meta">These results were generated by <a href="https://github.com/OpenSourcePolicyCenter/webapp-public/tree/v{{webapp_version}}"> PolicyBrain version {{ webapp_version }}</a>  on {{ created_on|date:"D, M jS Y \a\t g:iA" }} UTC using <a href="https://github.com/PSLmodels/Tax-Calculator/tree/{{taxcalc_version}}"> Tax-Calculator version {{ taxcalc_version }}.</a> </p>
    {% if quick_calc %}
    <p class="meta">This calculation used only a small sample of the available data and only calculated revenues for one year instead of ten. For the full results, <a href="/taxbrain/submit/{{ unique_url.pk }}/">click here</a></p>

    {% endif %}
    {% if is_behavior %}
    <p class="meta">The microsimulation upon which this dynamic simulation was based can be found <a href="{{microsim_url}}">here</a> </p>
    {% endif %}
    <div class="result-table">
      <div class="result-table-controls">
        {% if is_micro and not is_from_file %}
        <a href="/taxbrain/edit/{{ unique_url.pk }}/?start_year={{ first_year }}" class="text-white btn btn-secondary">View Parameters</a>
        {% endif %}
        {% if is_behavior and not is_from_file %}
        <a href="/dynamic/behavioral/edit/{{ unique_url.pk }}/?start_year={{ first_year }}" class="text-white btn btn-secondary">View Parameters</a>
        {% endif %}
        {% if is_micro %}
        {% if allow_dyn_links %}
        <button onclick="buttonAction()" class="text-white btn btn-secondary">Link to Dynamic Simulations</button>
        {% endif %}
        {% endif %}
      </div>
      {% if reform_file_contents and assump_file_contents %}
      {% if is_from_file %}
      <h2>The following reform file(s) were uploaded for this simulation: </h2>
      {% else %}
      <h2>The following parameters were used for this simulation: </h2>
      {% endif %}
      <div class="file-contents">
          <h3>Reform</h3>
          {%autoescape off %}
          {{ reform_file_contents | nbsp | linebreaks | safe}}
          {%endautoescape %}
          <h3>Assumptions</h3>
          {%autoescape off %}
          {{ assump_file_contents | nbsp | linebreaks | safe}}
          {%endautoescape %}
      </div>
      {% endif %}
    </div>
  </div>
  <br>
  <div data-tables="{{tables}}"></div>
  <div id="table-drilldown-container"></div>
  <div class="push"></div>
</div>
  <div class="modal fade" id="block-link-modal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
    <div class="modal-dialog" role="document">
      <div class="modal-content">
        <div class="modal-header">
          <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
          <h4 class="modal-title" id="myModalLabel">Dynamic Simulation Link Unavailable</h4>
        </div>
        <div class="modal-body">
          Oops. Your simulation already had behavioral parameters. You can't link this simulation to a dynamic simulation.
        </div>
        <div class="modal-footer">
          <a type="button" class="btn btn-default" data-dismiss="modal">Got it.</a>
        </div>
      </div>
    </div>
  </div>
  <div class="modal fade" id="redirect-modal" tabindex="-1" role="dialog" aria-labelledby="redirect-modal-label">
    <div class="modal-dialog" role="document">
      <div class="modal-content">
        <div class="modal-header">
          <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
          <h4 class="modal-title" id="redirect-modal-label">Your sim is now archived.</h4>
        </div>
        <div class="modal-body">
          <p>You may view results and inputs but not edit parameters or re-run the simulation.</p>
          <p>The Tax-Brain webapp is now hosted at <a href="https://compmodels.org/PSLmodels/Tax-Brain/">compmodels.org/PSLmodels/Tax-Brain/</a></p>
        </div>
        <div class="modal-footer">
          <a type="button" class="btn btn-default" data-dismiss="modal">Close</a>
        </div>
      </div>
    </div>
  </div>

{% endblock %}

{% block bottom_scripts %}
{{ block.super }}
<script src="{% static 'js/vendor/underscore/underscore-min.js' %}"></script>
<script src="{% static 'js/vendor/backbone/backbone-min.js' %}"></script>
<script src="{% static 'js/vendor/DataTables/datatables.js' %}"></script>
<script src="{% static 'js/taxbrain-tablebuilder.js' %}"></script>
<script>
    function buttonAction() {
        if ({{allow_dyn_links|yesno:"true,false,true"}} ) {
            window.location.href = "/dynamic/{{ unique_url.pk }}/?start_year={{ first_year }}";
            } else {
            $('#block-link-modal').modal('show');
        }
    }
</script>
<script>
  $(document).ready(function() {
    $("#redirect-modal").modal("show");
  });
</script>
{% endblock %}
